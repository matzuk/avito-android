<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="CI Gradle Plugin"><meta property="og:title" content="CI Gradle Plugin"><meta property="og:description" content="CI Gradle plugin Для настройки CI под конкретный Gradle модуль используется in-house плагин.
Решает задачу точечной настройки типа и строгости проверок для разных сценариев.
plugins { id(&#34;com.avito.android.cd&#34;) } builds { ... } Применяется например в модуле приложения, однако нет никаких ограничений, чтобы применить плагин как-то иначе (см. ./build.gradle)
Builds Используется набор захардкоженых сценариев(builds):
builds { fastCheck { ... } }  localCheck - проверки компиляции на локальной машине fastCheck - максимально быстрые проверки, выполняющие требования к CI fullCheck - максимально полные проверки, можем жертвовать скоростью release - набор действий необходимых для предоставления всех релизных артефактов  Steps Step is a declaration to run some logic."><meta property="og:type" content="article"><meta property="og:url" content="https://avito-tech.github.io/avito-android/docs/ci/cigradleplugin/"><title>CI Gradle Plugin | Avito Android</title><link rel=icon href=/avito-android/favicon.ico type=image/x-icon><link rel=stylesheet href=/avito-android/book.min.66d2f6926159dd697150bdcd901eead56a7adc9408513ccb9ab553939262dd4c.css integrity="sha256-ZtL2kmFZ3WlxUL3NkB7q1Wp63JQIUTzLmrVTk5Ji3Uw="><script defer src=/avito-android/en.search.min.8a19ce4e0f8c0d5a0460d3ce72913608fd329db0eb7e71dad0bbeb172b657ad3.js integrity="sha256-ihnOTg+MDVoEYNPOcpE2CP0ynbDrfnHa0LvrFytletM="></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-157613383-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body><input type=checkbox class=hidden id=menu-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/avito-android><span>Avito Android</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://avito-tech.github.io/avito-android/>Introduction</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/tech_radar/techradar/>Tech radar</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/knownissues/>Known Issues</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/contacts/>Contacts</a></li><li>Projects<ul><li><a href=https://avito-tech.github.io/avito-android/docs/projects/buildchecks/>Build checks</a></li></ul></li><li>Contributing<ul><li><a href=https://avito-tech.github.io/avito-android/docs/contributing/howtostart/>How to start</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/contributing/docs/>Documentation</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/contributing/codereview/>Code Review</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/contributing/codestyle/>Code Style</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/contributing/featuretoggles/>Feature Toggles</a></li></ul></li><li>IDE<ul><li><a href=https://avito-tech.github.io/avito-android/docs/ide/configurations/>Конфигурации</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/ide/templates/>Шаблоны</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/ide/speedup/>Ускорение</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/ide/benchmarking/>Бенчмарки</a></li></ul></li><li>Сборка<ul><li><a href=https://avito-tech.github.io/avito-android/docs/ide/configurations/>Запуск</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/buildtypes/>Типы сборки</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/dependencies/>Зависимости</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/minimization/>Минимизация</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/benchmarks/>Бенчмарки</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/profiling/>Профилирование</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/buildmetrics/>Метрики</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/mirakle/>Mirakle</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/troubleshooting/>Troubleshooting</a></li></ul></li><li>Architecture<ul><li><a href=https://avito-tech.github.io/avito-android/docs/architecture/dagger/>Dagger</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/architecture/modules/>Модули</a></li></ul></li><li><a href=https://avito-tech.github.io/avito-android/docs/analytics/analytics/>Аналитика</a><ul><li><a href=https://avito-tech.github.io/avito-android/docs/analytics/statsd/>Statsd</a></li></ul></li><li>Testing<ul><li><a href=https://avito-tech.github.io/avito-android/docs/test/run/>Запуск тестов</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/manual/>Ручное</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/testmanagementsystem/>Test Management System</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/testcaseincode/>Test case in code</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/runner/>Test Runner</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/unittesting/>Юнит тесты</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/screenshottesting/>Скриншотные тесты</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/testminimized/>Test minimized</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/reportviewer/>Report Viewer</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/troubleshootingui/>Troubleshooting</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/workmanager/>Work Manager Testing</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/flakytests/>Flaky Tests</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/toast/>Toast</a></li></ul></li><li><a href=https://avito-tech.github.io/avito-android/docs/test_framework/testframework/>Test framework</a><ul><li><a href=https://avito-tech.github.io/avito-android/docs/test_framework/mocking/>Mocking</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test_framework/internals/>Internals</a></li></ul></li><li><a href=http://links.k.avito.ru/ff>Design System</a></li><li>Performance<ul><li><a href=https://avito-tech.github.io/avito-android/docs/performance/analytics/>Аналитика</a></li></ul></li><li>Checks<ul><li><a href=https://avito-tech.github.io/avito-android/docs/checks/androidlint/>Android lint</a></li></ul></li><li>CI<ul><li><a href=https://avito-tech.github.io/avito-android/docs/ci/civalues/>Требования</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/ci/cigradleplugin/>CI Gradle Plugin</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/ci/customgradleplugins/>Custom Gradle Plugins</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/ci/impactanalysis/>Impact analysis</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/ci/containers/>Containers</a></li></ul></li><li>CD<ul><li><a href=https://avito-tech.github.io/avito-android/docs/cd/release/>Релиз</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/cd/artifacts/>Артефакты сборки</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/cd/qapps/>QApps</a></li></ul></li><li><a href=https://avito-tech.github.io/avito-android/docs/infrastructure/>Infrastructure (Github project)</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/externallibrarychangeprocess/>Внешние библиотеки</a></li><li><a href=/avito-android/posts/>Blog</a></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/avito-android/svg/menu.svg class=book-icon alt=Menu></label>
<strong>CI Gradle Plugin</strong>
<label for=toc-control><img src=/avito-android/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><input type=checkbox class=hidden id=toc-control><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#builds>Builds</a></li><li><a href=#steps>Steps</a><ul><li><a href=#built-in-steps>Built-in steps</a><ul><li><a href=#ui-tests>UI tests</a></li><li><a href=#performance-tests>Performance tests</a></li><li><a href=#android-lint>Android lint</a></li><li><a href=#compile-ui-tests>Compile UI tests</a></li><li><a href=#unit-tests>Unit tests</a></li><li><a href=#upload-to-qapps>Upload to QApps</a></li><li><a href=#upload-to-artifactory>Upload to Artifactory</a></li><li><a href=#upload-to-prosector>Upload to Prosector</a></li><li><a href=#upload-build-results>Upload build results</a></li><li><a href=#deploy-to-google-play>Deploy to Google Play</a></li><li><a href=#configuration-checks>Configuration checks</a></li></ul></li><li><a href=#using-impact-analysis-in-step>Using impact analysis in step</a></li><li><a href=#suppressing-errors-in-step>Suppressing errors in step</a></li><li><a href=#collecting-artifacts>Collecting artifacts</a></li><li><a href=#writing-a-custom-step>Writing a custom step</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=ci-gradle-plugin>CI Gradle plugin</h1><p>Для настройки CI под конкретный Gradle модуль используется in-house плагин.</p><p>Решает задачу точечной настройки типа и строгости проверок для разных сценариев.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>plugins <span style=color:#f92672>{</span>
    id<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;com.avito.android.cd&#34;</span><span style=color:#f92672>)</span>
<span style=color:#f92672>}</span>

builds <span style=color:#f92672>{</span>
   <span style=color:#f92672>.</span><span style=color:#f92672>.</span><span style=color:#f92672>.</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>Применяется например в модуле приложения, однако нет никаких ограничений, чтобы применить плагин как-то иначе (см. <code>./build.gradle</code>)</p><h2 id=builds>Builds</h2><p>Используется набор захардкоженых сценариев(builds):</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>builds <span style=color:#f92672>{</span>
    fastCheck <span style=color:#f92672>{</span>
       <span style=color:#f92672>.</span><span style=color:#f92672>.</span><span style=color:#f92672>.</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><ul><li>localCheck - проверки компиляции на локальной машине</li><li>fastCheck - максимально быстрые проверки, выполняющие <a href=https://avito-tech.github.io/avito-android/docs/ci/civalues/>требования к CI</a></li><li>fullCheck - максимально полные проверки, можем жертвовать скоростью</li><li>release - набор действий необходимых для предоставления всех релизных артефактов</li></ul><h2 id=steps>Steps</h2><p>Step is a declaration to run some logic. It works inside a scenario:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>fastCheck <span style=color:#f92672>{</span> <span style=color:#75715e>// &lt;--- scenario (build)
</span><span style=color:#75715e></span>    unitTests <span style=color:#f92672>{</span><span style=color:#f92672>}</span> <span style=color:#75715e>// &lt;--- step
</span><span style=color:#75715e></span>    uiTests <span style=color:#f92672>{</span><span style=color:#f92672>}</span>
    lint <span style=color:#f92672>{</span><span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><h3 id=built-in-steps>Built-in steps</h3><h4 id=ui-tests>UI tests</h4><p>Runs instrumentation tests.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>uiTests <span style=color:#f92672>{</span>
  configurations <span style=color:#f92672>=</span> <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;configurationName&#34;</span><span style=color:#f92672>]</span> <span style=color:#75715e>// list of instrumentation configuration to depends on
</span><span style=color:#75715e></span>  sendStatistics <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span> <span style=color:#75715e>// by default
</span><span style=color:#75715e></span>  suppressFailures <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span> <span style=color:#75715e>// by default
</span><span style=color:#75715e></span>  useImpactAnalysis <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span> <span style=color:#75715e>// by default
</span><span style=color:#75715e></span>  suppressFlaky <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span> <span style=color:#75715e>// by default. [игнорирование падений FlakyTest](https://avito-tech.github.io/avito-android/docs/test/flakytests/).
</span><span style=color:#75715e></span><span style=color:#f92672>}</span>
</code></pre></div><h4 id=performance-tests>Performance tests</h4><p>Runs performance tests.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>performanceTests <span style=color:#f92672>{</span>
  configuration <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;configuration name&#34;</span> <span style=color:#75715e>// performance configuration from Instrumentation plugin
</span><span style=color:#75715e></span>  enabled <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span> <span style=color:#75715e>// true by default
</span><span style=color:#75715e></span><span style=color:#f92672>}</span>
</code></pre></div><h4 id=android-lint>Android lint</h4><p>Run <a href=https://avito-tech.github.io/avito-android/docs/checks/androidlint/>Android lint</a> tasks.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>lint <span style=color:#f92672>{</span><span style=color:#f92672>}</span>
</code></pre></div><h4 id=compile-ui-tests>Compile UI tests</h4><p>Compile instrumentation tests. It is helpful in local development.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>compileUiTests <span style=color:#f92672>{</span><span style=color:#f92672>}</span>
</code></pre></div><h4 id=unit-tests>Unit tests</h4><p>Run unit tests.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>unitTests <span style=color:#f92672>{</span><span style=color:#f92672>}</span>
</code></pre></div><h4 id=upload-to-qapps>Upload to QApps</h4><blockquote class="book-hint info">This step contains Avito specific details</blockquote><p>Upload <a href=#collecting-artifacts>artifacts</a> to QApps (internal system)</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>artifacts <span style=color:#f92672>{</span>
    apk<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;debugApk&#34;</span><span style=color:#f92672>,</span> <span style=color:#f92672>.</span><span style=color:#f92672>.</span><span style=color:#f92672>.</span><span style=color:#f92672>)</span>
<span style=color:#f92672>}</span>
uploadToQapps <span style=color:#f92672>{</span>
    artifacts <span style=color:#f92672>=</span> <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;debugApk&#34;</span><span style=color:#f92672>]</span>
<span style=color:#f92672>}</span>
</code></pre></div><h4 id=upload-to-artifactory>Upload to Artifactory</h4><p>Upload <a href=#collecting-artifacts>artifacts</a> to Artifactory.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>artifacts <span style=color:#f92672>{</span>
    file<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;myReport&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;${project.buildDir}/reports/my_report.json&#34;</span><span style=color:#f92672>)</span>
<span style=color:#f92672>}</span>
uploadToArtifactory <span style=color:#f92672>{</span>
    artifacts <span style=color:#f92672>=</span> <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;myReport&#34;</span><span style=color:#f92672>]</span>
<span style=color:#f92672>}</span>
</code></pre></div><h4 id=upload-to-prosector>Upload to Prosector</h4><blockquote class="book-hint info">This step contains Avito specific details</blockquote><p>Upload <a href=#collecting-artifacts>artifacts</a> to <a href=http://links.k.avito.ru/cfxrREPBQ>Prosector (internal)</a>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>artifacts <span style=color:#f92672>{</span>
    apk<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;debugApk&#34;</span><span style=color:#f92672>,</span> <span style=color:#f92672>.</span><span style=color:#f92672>.</span><span style=color:#f92672>.</span><span style=color:#f92672>)</span>
<span style=color:#f92672>}</span>
uploadToProsector <span style=color:#f92672>{</span>
    artifacts <span style=color:#f92672>=</span> <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;debugApk&#34;</span><span style=color:#f92672>]</span>
<span style=color:#f92672>}</span>
</code></pre></div><h4 id=upload-build-results>Upload build results</h4><blockquote class="book-hint info">This step contains Avito specific details</blockquote><p>Upload all build results to a deploy service.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>uploadBuildResult <span style=color:#f92672>{</span>
    uiTestConfiguration <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;regression&#34;</span> <span style=color:#75715e>// instrumentation configuration
</span><span style=color:#75715e></span><span style=color:#f92672>}</span>
</code></pre></div><h4 id=deploy-to-google-play>Deploy to Google Play</h4><blockquote class="book-hint info">This step contains Avito specific details</blockquote><p>Deploy to Google play.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>deploy <span style=color:#f92672>{</span><span style=color:#f92672>}</span>
</code></pre></div><h4 id=configuration-checks>Configuration checks</h4><blockquote class="book-hint info">This check contains Avito specific details</blockquote><p>Checks a repository configuration. See <code>:build-script-test</code> for details.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>    configuration <span style=color:#f92672>{</span><span style=color:#f92672>}</span>
</code></pre></div><h3 id=using-impact-analysis-in-step>Using impact analysis in step</h3><p>Сценарий может использовать <a href=https://avito-tech.github.io/avito-android/docs/ci/impactanalysis/>Impact analysis</a>(по-умолчанию отключено):</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>fastCheck <span style=color:#f92672>{</span>
    uiTests <span style=color:#f92672>{</span>
        useImpactAnalysis <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><h3 id=suppressing-errors-in-step>Suppressing errors in step</h3><p>В разных сценариях падения шагов могут ронять за собой весь билд, а можно настроить чтобы билд не упал.
Обработка этого флага должна быть явно поддержана шагом.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>fastCheck <span style=color:#f92672>{</span>
    uiTests <span style=color:#f92672>{</span> 
        suppressFailures <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span> 
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>

release <span style=color:#f92672>{</span>
    uiTests <span style=color:#f92672>{</span> 
        suppressFailures <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span> 
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><h3 id=collecting-artifacts>Collecting artifacts</h3><p>Артефакты, которые планируется как-то использовать нужно зарегистрировать специальным образом</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>artifacts <span style=color:#f92672>{</span>
   file<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;lintReport&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;${project.buildDir}/reports/lint-results-release.html&#34;</span><span style=color:#f92672>)</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>Есть разные типы артефактов, различаются по типам проверок и способу описания путей</p><ul><li>apk - достает apk по buildType и проверяют пакет и подпись</li><li>bundle - достает bundle по buildType и проверяют пакет и подпись</li><li>mapping - достает mapping по buildType и проверяют наличие</li><li>file - простой доступ к файлу по пути и проверка на наличие</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>artifacts <span style=color:#f92672>{</span>
   apk<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;releaseApk&#34;</span><span style=color:#f92672>,</span> RELEASE<span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;com.avito.android&#34;</span><span style=color:#f92672>,</span> apkPath<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;release&#34;</span><span style=color:#f92672>)</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span> signature <span style=color:#f92672>=</span> releaseSha1 <span style=color:#f92672>}</span>
   bundle<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;releaseBundle&#34;</span><span style=color:#f92672>,</span> RELEASE<span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;com.avito.android&#34;</span><span style=color:#f92672>,</span> bundlePath<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;release&#34;</span><span style=color:#f92672>)</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span> signature <span style=color:#f92672>=</span> releaseSha1 <span style=color:#f92672>}</span>
   mapping<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;releaseMapping&#34;</span><span style=color:#f92672>,</span> RELEASE<span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;${project.buildDir}/outputs/mapping/release/mapping.txt&#34;</span><span style=color:#f92672>)</span>
   file<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;featureTogglesJson&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;${project.buildDir}/reports/feature_toggles.json&#34;</span><span style=color:#f92672>)</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>Первый аргумент - регистрирует ключ, который затем используется в upload шагах для указания артефактов</p><h3 id=writing-a-custom-step>Writing a custom step</h3><p>По необходимости добавляем свои шаги, наследуясь от <code>BuildStep</code></p></article><footer class=book-footer><div class="flex justify-between"><div><a class="flex align-center" href=https://github.com/avito-tech/avito-android/tree/develop/docs/content/docs/ci/CIGradlePlugin.md target=_blank rel=noopener><img src=/avito-android/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div><div><a class="flex justify-end" href=/avito-android/docs/contacts><span>Contact us</span></a></div></div><div class=book-comments></div></footer></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#builds>Builds</a></li><li><a href=#steps>Steps</a><ul><li><a href=#built-in-steps>Built-in steps</a><ul><li><a href=#ui-tests>UI tests</a></li><li><a href=#performance-tests>Performance tests</a></li><li><a href=#android-lint>Android lint</a></li><li><a href=#compile-ui-tests>Compile UI tests</a></li><li><a href=#unit-tests>Unit tests</a></li><li><a href=#upload-to-qapps>Upload to QApps</a></li><li><a href=#upload-to-artifactory>Upload to Artifactory</a></li><li><a href=#upload-to-prosector>Upload to Prosector</a></li><li><a href=#upload-build-results>Upload build results</a></li><li><a href=#deploy-to-google-play>Deploy to Google Play</a></li><li><a href=#configuration-checks>Configuration checks</a></li></ul></li><li><a href=#using-impact-analysis-in-step>Using impact analysis in step</a></li><li><a href=#suppressing-errors-in-step>Suppressing errors in step</a></li><li><a href=#collecting-artifacts>Collecting artifacts</a></li><li><a href=#writing-a-custom-step>Writing a custom step</a></li></ul></li></ul></nav></aside></main></body></html>